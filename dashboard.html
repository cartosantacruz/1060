<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoNube - Dashboard</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Google Font: Source Sans Pro -->
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        body {
            font-family: 'Source Sans Pro', sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }
        #wrapper {
            display: flex;
            flex: 1;
        }
        #sidebar-wrapper {
            min-width: 250px;
            max-width: 250px;
            background-color: #343a40; /* Dark sidebar */
            color: #fff;
            transition: all 0.3s ease;
            position: sticky;
            top: 0;
            height: 100vh; /* Full height */
            overflow-y: auto; /* Scrollable sidebar */
            padding-top: 50px; /* Space for fixed navbar */
        }
        #sidebar-wrapper.toggled {
            margin-left: -250px;
        }
        #page-content-wrapper {
            flex-grow: 1;
            padding: 20px;
            background-color: #f4f6f9;
        }
        .navbar-custom {
            background-color: #3c8dbc; /* AdminLTE blue */
            border-color: #367fa9;
            color: #fff;
            position: fixed;
            width: 100%;
            z-index: 1000;
        }
        .navbar-custom .navbar-brand,
        .navbar-custom .navbar-nav > li > a {
            color: #fff;
        }
        .navbar-custom .navbar-nav > li > a:hover,
        .navbar-custom .navbar-nav > li > a:focus {
            background-color: #367fa9;
        }
        .sidebar-brand {
            height: 50px;
            line-height: 50px;
            font-size: 1.5em;
            text-align: center;
            background-color: #222d32; /* Darker sidebar header */
            color: #fff;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1001; /* Above main sidebar content */
        }
        .sidebar-nav {
            position: absolute;
            top: 50px; /* Below brand */
            width: 100%;
            margin: 0;
            padding: 0;
            list-style: none;
        }
        .sidebar-nav li {
            text-indent: 20px;
            line-height: 40px;
        }
        .sidebar-nav li a {
            display: block;
            text-decoration: none;
            color: #b8c7ce;
            transition: all 0.2s ease;
        }
        .sidebar-nav li a:hover {
            color: #fff;
            background: #1e282c;
        }
        .content-header {
            padding: 15px 15px 0 15px;
            margin-bottom: 20px;
            background-color: #fff;
            border-bottom: 1px solid #dee2e6;
            border-radius: 5px;
        }
        .content-header h1 {
            font-size: 24px;
            margin: 0;
            line-height: 1;
            padding-bottom: 15px;
        }
        .content-header ol.breadcrumb {
            background-color: transparent;
            margin-bottom: 0;
            padding-left: 0;
        }
        .nav-tabs-custom > .nav-tabs {
            margin: 0;
            border-bottom-color: #f4f4f4;
        }
        .nav-tabs-custom > .nav-tabs > li.active > a {
            border-top-color: #3c8dbc;
        }
        .box {
            background: #fff;
            border-radius: 5px;
            border-top: 3px solid #d2d6de;
            margin-bottom: 20px;
            width: 100%;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        .box-header {
            color: #444;
            display: block;
            padding: 10px;
            position: relative;
        }
        .box-title {
            display: inline-block;
            font-size: 18px;
            margin: 0;
            line-height: 1;
        }
        .box-body {
            padding: 10px;
        }
        .card-item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }
        .card-item h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #3c8dbc;
        }
        .card-item p {
            font-size: 0.9em;
            color: #666;
            flex-grow: 1;
        }
        .card-actions {
            margin-top: 15px;
            text-align: right;
        }
        .card-actions .btn {
            margin-left: 5px;
            border-radius: 5px;
        }
        .loader {
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2em;
            display: none; /* Hidden by default */
        }
        .modal-xl {
            width: 90%;
            max-width: 1200px;
        }
        .modal-data-container {
            max-height: 70vh;
            overflow-y: auto;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .pagination-container .pagination {
            margin: 0;
        }
        .pagination-container .pagination li a,
        .pagination-container .pagination li span {
            border-radius: 5px;
            margin: 0 2px;
        }
        .pagination-container .page-item input {
            width: 60px;
            text-align: center;
            height: 34px;
            margin: 0 5px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .pagination-container .page-item button {
            height: 34px;
            border-radius: 5px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #sidebar-wrapper {
                margin-left: -250px;
                position: fixed; /* Keep sidebar fixed on mobile */
                height: 100%;
                z-index: 1000;
                padding-top: 70px; /* Adjust for taller mobile navbar */
            }
            #sidebar-wrapper.toggled {
                margin-left: 0;
            }
            #page-content-wrapper {
                padding-left: 0;
                padding-right: 0;
            }
            .navbar-toggle {
                display: block;
            }
            .navbar-header {
                float: none;
            }
            .navbar-collapse.collapse {
                display: none!important;
            }
            .navbar-collapse.collapse.in {
                display: block!important;
            }
            .navbar-nav {
                float: none!important;
                margin: 7.5px -15px;
            }
            .navbar-nav>li {
                float: none;
            }
            .navbar-nav>li>a {
                padding-top: 10px;
                padding-bottom: 10px;
            }
            .navbar-text {
                float: none;
                margin: 15px 0;
            }
            .navbar-collapse .navbar-form {
                margin-left: 0;
                margin-right: 0;
                padding: 10px 15px;
                border-top: 1px solid #eee;
                border-bottom: 1px solid #eee;
            }
            .navbar-collapse .navbar-form .form-group {
                margin-bottom: 0;
            }
            .navbar-collapse .navbar-form .input-group {
                width: 100%;
            }
            .navbar-collapse .navbar-form .input-group .form-control {
                width: 100%;
            }
            .navbar-nav .open .dropdown-menu {
                position: static;
                float: none;
                width: auto;
                margin-top: 0;
                background-color: transparent;
                border: 0;
                box-shadow: none;
            }
            .navbar-nav .open .dropdown-menu > li > a,
            .navbar-nav .open .dropdown-menu .dropdown-header {
                padding: 5px 15px 5px 25px;
            }
            .navbar-nav .open .dropdown-menu > li > a {
                line-height: 20px;
            }
            .navbar-nav .open .dropdown-menu > li > a:hover,
            .navbar-nav .open .dropdown-menu > li > a:focus {
                background-image: none;
            }
        }
    </style>
</head>
<body>
    <div class="loader">
        <i class="fa fa-spinner fa-spin"></i> Cargando...
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-main">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">GeoNube</a>
            </div>
            <div class="collapse navbar-collapse" id="navbar-collapse-main">
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i> Usuario <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Perfil</a></li>
                            <li><a href="#">Configuración</a></li>
                            <li class="divider"></li>
                            <li><a href="#">Cerrar Sesión</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper">
            <div class="sidebar-brand">
                GeoNube
            </div>
            <ul class="sidebar-nav">
                <li><a href="#" class="sidebar-link" data-target="dashboard"><i class="fa fa-dashboard"></i> Dashboard</a></li>
                <li><a href="#" class="sidebar-link active" data-target="visores"><i class="fa fa-map"></i> Visores</a></li>
                <li><a href="#" class="sidebar-link" data-target="capas"><i class="fa fa-th-list"></i> Capas</a></li>
                <li><a href="#" class="sidebar-link" data-target="estilos"><i class="fa fa-paint-brush"></i> Estilos</a></li>
                <li><a href="#" class="sidebar-link" data-target="configuracion"><i class="fa fa-cog"></i> Configuración</a></li>
            </ul>
        </div>

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <div class="container-fluid">
                <div class="content-header">
                    <h1>Dashboard <small id="currentSectionTitle">Visores</small></h1>
                    <ol class="breadcrumb">
                        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li class="active" id="breadcrumbActive">Visores</li>
                    </ol>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="box">
                            <div class="box-header with-border">
                                <h3 class="box-title">Gestión de <span id="currentSectionBoxTitle">Visores</span></h3>
                                <div class="box-tools pull-right">
                                    <div class="input-group input-group-sm" style="width: 250px;">
                                        <input type="text" name="table_search" class="form-control pull-right" placeholder="Buscar..." id="searchInput">
                                        <div class="input-group-btn">
                                            <button type="submit" class="btn btn-default"><i class="fa fa-search"></i></button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-success btn-sm" id="newBtn" style="margin-left: 10px;">
                                        <i class="fa fa-plus"></i> Nuevo <span id="newBtnText">Visor</span>
                                    </button>
                                </div>
                            </div>
                            <div class="box-body">
                                <ul class="nav nav-tabs nav-justified" id="contentTabs">
                                    <li class="active"><a href="#visores-tab" data-toggle="tab" data-type="visores">Visores</a></li>
                                    <li><a href="#capas-tab" data-toggle="tab" data-type="capas">Capas</a></li>
                                    <li><a href="#estilos-tab" data-toggle="tab" data-type="estilos">Estilos</a></li>
                                </ul>
                                <div class="tab-content" style="padding-top: 20px;">
                                    <div class="tab-pane active" id="visores-tab">
                                        <div class="row" id="visoresContainer">
                                            <!-- Visor cards will be loaded here -->
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="capas-tab">
                                        <div class="row" id="capasContainer">
                                            <!-- Capa cards will be loaded here -->
                                        </div>
                                    </div>
                                    <div class="tab-pane" id="estilos-tab">
                                        <div class="row" id="estilosContainer">
                                            <!-- Estilo cards will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                                <div class="pagination-container">
                                    <ul class="pagination pagination-sm" id="paginationControls">
                                        <!-- Pagination will be loaded here -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Generic Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="confirmModalLabel">Confirmar Acción</h4>
                </div>
                <div class="modal-body">
                    ¿Estás seguro de que quieres <span id="confirmActionText"></span> este elemento?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generic Details Modal -->
    <div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white" style="background-color: #3c8dbc; color: white;">
                    <h4 class="modal-title" id="detailsModalLabel">Detalles del Elemento</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="font-size: 28px; opacity: 1; color: white; text-shadow: none; padding: 0 10px; margin: -10px 0;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body bg-light p-0">
                    <div class="modal-data-container w-100 p-3 bg-white">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script>
        // Global variables for data and pagination
        let currentDataType = 'visores';
        let currentPage = 1;
        const itemsPerPage = 6; // Number of cards per page

        // Helper function to show loader
        function showLoader() {
            $('.loader').show();
        }

        // Helper function to hide loader
        function hideLoader() {
            $('.loader').hide();
        }

        // Function to load data from localStorage
        function loadData(type) {
            try {
                const data = localStorage.getItem(type);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error("Error loading data from localStorage for type:", type, e);
                return [];
            }
        }

        // Function to save data to localStorage
        function saveData(type, data) {
            try {
                localStorage.setItem(type, JSON.stringify(data));
            } catch (e) {
                console.error("Error saving data to localStorage for type:", type, e);
            }
        }

        // Function to render cards for a given data type
        function renderCards() {
            showLoader();
            setTimeout(() => { // Simulate async loading
                const data = loadData(currentDataType);
                const searchTerm = $('#searchInput').val().toLowerCase();
                const filteredData = data.filter(item =>
                    (item.nombre && item.nombre.toLowerCase().includes(searchTerm)) ||
                    (item.descripcion && item.descripcion.toLowerCase().includes(searchTerm)) ||
                    (item.titulo && item.titulo.toLowerCase().includes(searchTerm)) // For visores
                );

                const totalPages = Math.ceil(filteredData.length / itemsPerPage);
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const paginatedData = filteredData.slice(startIndex, endIndex);

                let html = '';
                if (paginatedData.length === 0) {
                    html = '<div class="col-xs-12 text-center"><p>No hay elementos para mostrar.</p></div>';
                } else {
                    paginatedData.forEach(item => {
                        const id = item.id || item.nombre; // Use id or name as a fallback unique identifier
                        const title = item.nombre || item.titulo || 'Sin Título';
                        const description = item.descripcion || 'Sin descripción.';

                        html += `
                            <div class="col-lg-4 col-md-6 col-sm-12">
                                <div class="card-item">
                                    <div>
                                        <h4>${title}</h4>
                                        <p>${description}</p>
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn btn-info btn-sm btn-view" data-id="${id}" data-type="${currentDataType}">
                                            <i class="fa fa-eye"></i> Ver
                                        </button>
                                        <button class="btn btn-primary btn-sm btn-edit" data-id="${id}" data-type="${currentDataType}">
                                            <i class="fa fa-edit"></i> Editar
                                        </button>
                                        <button class="btn btn-danger btn-sm btn-delete" data-id="${id}" data-type="${currentDataType}">
                                            <i class="fa fa-trash"></i> Eliminar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
                $(`#${currentDataType}Container`).html(html);
                renderPagination(totalPages);
                hideLoader();
            }, 300); // Simulate network delay
        }

        // Function to render pagination controls
        function renderPagination(totalPages) {
            let paginationHtml = '';

            // Previous button
            paginationHtml += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                                    <a class="page-link" href="#" data-page="${currentPage - 1}">&laquo;</a>
                                </li>`;

            // Page numbers
            const maxPagesToShow = 5; // Max number of page buttons to show
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

            if (endPage - startPage + 1 < maxPagesToShow) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationHtml += `<li class="page-item ${currentPage === i ? 'active' : ''}">
                                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                                    </li>`;
            }

            // Next button
            paginationHtml += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                                    <a class="page-link" href="#" data-page="${currentPage + 1}">&raquo;</a>
                                </li>`;

            $('#paginationControls').html(paginationHtml);
        }

        // Handle tab clicks
        $('#contentTabs a').on('click', function (e) {
            e.preventDefault();
            $(this).tab('show');
            currentDataType = $(this).data('type');
            currentPage = 1; // Reset to first page on tab change
            $('#currentSectionTitle').text($(this).text());
            $('#breadcrumbActive').text($(this).text());
            $('#currentSectionBoxTitle').text($(this).text());
            $('#newBtnText').text($(this).text().slice(0, -1)); // Remove 's' for singular
            renderCards();
        });

        // Handle sidebar link clicks (for future expansion, currently just changes active state)
        $('.sidebar-link').on('click', function(e) {
            e.preventDefault();
            $('.sidebar-link').removeClass('active');
            $(this).addClass('active');
            const target = $(this).data('target');
            if (target === 'dashboard' || target === 'configuracion') {
                // For dashboard and config, just update titles for now
                $('#currentSectionTitle').text($(this).text());
                $('#breadcrumbActive').text($(this).text());
                $('#currentSectionBoxTitle').text($(this).text());
                $('#newBtn').hide(); // Hide new button for these sections
                $(`#visoresContainer, #capasContainer, #estilosContainer`).empty(); // Clear content
                $('#paginationControls').empty(); // Clear pagination
                $('#contentTabs').hide(); // Hide tabs
                // You could add specific content for these sections here
                $(`#${currentDataType}Container`).html('<div class="col-xs-12 text-center"><p>Contenido para esta sección.</p></div>');
            } else {
                $('#newBtn').show();
                $('#contentTabs').show();
                $(`#contentTabs a[data-type="${target}"]`).click(); // Simulate click on the tab
            }

            // For mobile, hide sidebar after click
            if ($(window).width() <= 768) {
                $('#wrapper').removeClass('toggled');
            }
        });


        // Handle search input
        $('#searchInput').on('keyup', function () {
            currentPage = 1; // Reset to first page on search
            renderCards();
        });

        // Handle pagination clicks
        $(document).on('click', '#paginationControls a.page-link', function (e) {
            e.preventDefault();
            const newPage = parseInt($(this).data('page'));
            if (!isNaN(newPage) && newPage > 0 && newPage <= Math.ceil(loadData(currentDataType).filter(item =>
                (item.nombre && item.nombre.toLowerCase().includes($('#searchInput').val().toLowerCase())) ||
                (item.descripcion && item.descripcion.toLowerCase().includes($('#searchInput').val().toLowerCase())) ||
                (item.titulo && item.titulo.toLowerCase().includes($('#searchInput').val().toLowerCase()))
            ).length / itemsPerPage)) {
                currentPage = newPage;
                renderCards();
            }
        });

        // Handle "Nuevo" button click
        $('#newBtn').on('click', function() {
            let redirectUrl = '';
            switch (currentDataType) {
                case 'visores':
                    redirectUrl = 'visor.html';
                    break;
                case 'capas':
                    redirectUrl = 'capas.html';
                    break;
                case 'estilos':
                    redirectUrl = 'estilos.html';
                    break;
            }
            if (redirectUrl) {
                window.location.href = redirectUrl;
            } else {
                // Handle case where no specific page exists
                alertMessage('Información', 'No se ha configurado una página para crear este tipo de elemento.');
            }
        });

        // Handle "Ver" button click
        $(document).on('click', '.btn-view', function () {
            const id = $(this).data('id');
            const type = $(this).data('type');
            const data = loadData(type);
            const item = data.find(i => (i.id && i.id === id) || (i.nombre && i.nombre === id)); // Find by id or name

            if (item) {
                let htmlContent = '<table class="table table-striped table-bordered">';
                for (const key in item) {
                    if (item.hasOwnProperty(key)) {
                        htmlContent += `<tr><th>${key}</th><td>${item[key]}</td></tr>`;
                    }
                }
                htmlContent += '</table>';
                $('#detailsModalLabel').text(`Detalles de ${item.nombre || item.titulo || 'Elemento'}`);
                $('#detailsModal .modal-data-container').html(htmlContent);
                $('#detailsModal').modal('show');
            } else {
                alertMessage('Error', 'Elemento no encontrado.');
            }
        });

        // Handle "Editar" button click
        $(document).on('click', '.btn-edit', function () {
            const id = $(this).data('id');
            const type = $(this).data('type');
            alertMessage('Información', `Simulando edición de ${type} con ID: ${id}`);
            // In a real application, you would redirect to an edit page:
            // window.location.href = `${type}.html?id=${id}`;
        });

        // Handle "Eliminar" button click
        $(document).on('click', '.btn-delete', function () {
            const idToDelete = $(this).data('id');
            const typeToDelete = $(this).data('type');
            $('#confirmActionText').text('eliminar');
            $('#confirmDeleteBtn').data('id', idToDelete);
            $('#confirmDeleteBtn').data('type', typeToDelete);
            $('#confirmModal').modal('show');
        });

        // Confirm deletion
        $('#confirmDeleteBtn').on('click', function () {
            const id = $(this).data('id');
            const type = $(this).data('type');
            let data = loadData(type);
            const initialLength = data.length;
            data = data.filter(item => (item.id && item.id !== id) && (item.nombre && item.nombre !== id)); // Filter by id or name
            if (data.length < initialLength) {
                saveData(type, data);
                alertMessage('Éxito', 'Elemento eliminado correctamente.');
                $('#confirmModal').modal('hide');
                renderCards(); // Re-render the list
            } else {
                alertMessage('Error', 'No se pudo encontrar el elemento para eliminar.');
                $('#confirmModal').modal('hide');
            }
        });

        // Generic alert message function (replaces native alert)
        function alertMessage(title, message) {
            // Using Bootstrap's modal for custom alerts
            const alertModal = `
                <div class="modal fade" id="customAlertModal" tabindex="-1" role="dialog" aria-labelledby="customAlertModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title" id="customAlertModalLabel">${title}</h4>
                            </div>
                            <div class="modal-body">
                                ${message}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-dismiss="modal">Aceptar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            // Remove any existing alert modal before adding a new one
            $('#customAlertModal').remove();
            $('body').append(alertModal);
            $('#customAlertModal').modal('show');
        }

        // Initial rendering on document ready
        $(document).ready(function () {
            // Initialize dummy data if not present (for testing)
            if (!localStorage.getItem('visores')) {
                saveData('visores', [
                    { id: 'v1', nombre: 'Visor de Zonas Verdes', descripcion: 'Mapa interactivo de parques y áreas recreativas.', titulo: 'Visor de Zonas Verdes' },
                    { id: 'v2', nombre: 'Visor de Transporte Público', descripcion: 'Rutas y paradas de autobuses y trenes.', titulo: 'Visor de Transporte Público' },
                    { id: 'v3', nombre: 'Visor de Densidad Poblacional', descripcion: 'Análisis de la distribución de la población.', titulo: 'Visor de Densidad Poblacional' },
                    { id: 'v4', nombre: 'Visor de Riesgos Naturales', descripcion: 'Identificación de zonas propensas a desastres.', titulo: 'Visor de Riesgos Naturales' },
                    { id: 'v5', nombre: 'Visor de Infraestructura Urbana', descripcion: 'Ubicación de edificios, carreteras y servicios.', titulo: 'Visor de Infraestructura Urbana' },
                    { id: 'v6', nombre: 'Visor de Calidad del Aire', descripcion: 'Monitoreo de la contaminación atmosférica en tiempo real.', titulo: 'Visor de Calidad del Aire' },
                    { id: 'v7', nombre: 'Visor de Puntos de Interés Turístico', descripcion: 'Guía interactiva de atracciones y sitios históricos.', titulo: 'Visor de Puntos de Interés Turístico' }
                ]);
            }
            if (!localStorage.getItem('capas')) {
                saveData('capas', [
                    { id: 'c1', nombre: 'Calles Principales', descripcion: 'Capa vectorial de la red vial principal.', tipo: 'Línea', atributos: ['nombre', 'tipo'] },
                    { id: 'c2', nombre: 'Edificios Históricos', descripcion: 'Capa de puntos de edificios con valor patrimonial.', tipo: 'Punto', atributos: ['nombre', 'año_construccion', 'estilo'] },
                    { id: 'c3', nombre: 'Límites Administrativos', descripcion: 'Capa de polígonos de divisiones administrativas.', tipo: 'Polígono', atributos: ['nombre', 'superficie'] },
                    { id: 'c4', nombre: 'Hidrografía', descripcion: 'Capa de líneas de ríos y cuerpos de agua.', tipo: 'Línea', atributos: ['nombre', 'longitud'] }
                ]);
            }
            if (!localStorage.getItem('estilos')) {
                saveData('estilos', [
                    { id: 'e1', nombre: 'Estilo Urbano Básico', descripcion: 'Estilo de mapa con colores neutros para áreas urbanas.', tipo: 'Mapa Base', configuracion: { color: '#f0f0f0', linea: '#cccccc' } },
                    { id: 'e2', nombre: 'Estilo de Calor', descripcion: 'Estilo para visualizar densidad con gradientes de color.', tipo: 'Capa de Puntos', configuracion: { gradiente: 'rojo-amarillo' } },
                    { id: 'e3', nombre: 'Estilo de Contorno', descripcion: 'Estilo para resaltar contornos de polígonos.', tipo: 'Capa de Polígonos', configuracion: { borde: 'negro', relleno: 'transparente' } }
                ]);
            }

            // Initial render of visores
            renderCards();

            // Toggle sidebar for small screens
            $('.navbar-toggle').on('click', function() {
                $('#wrapper').toggleClass('toggled');
            });
        });
    </script>
</body>
</html>
